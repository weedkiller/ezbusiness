@model EzBusiness_ViewModels.Models.FinaceMgmt.FNM_SL_VM

@{

    var counter = 1;
}
<script src="~/Scripts/jquery-3.1.1.js"></script>
<script src="~/Scripts/moment.min.js"></script>
<script src="~/Scripts/bootstrap-select.min.js"></script>
<link href="~/Content/bootstrap-select.min.css" rel="stylesheet" />
<script src="~/Scripts/bootstrap-datetimepicker.min.js"></script>
<script src="~/Scripts/EzComNDW.js"></script>
<script>
    $(function () {
        arr1 = [];

        $('.selectpicker').selectpicker('refresh');

      //  EzdtePk('#ENTRY_DATE1');

        $('body').on('focus', ':input', function () {
            $(this).attr('autocomplete', 'off');
        });

        //----------------------

        $("input:radio[name=SUBLEDGER_TYPE]").click(function () {
            
            var rowCount = $('#tblFNMCURRATE tbody tr').length;

            while (rowCount > 1)
            {
                var $tbody = $("#tblFNMCURRATE tbody")
                var $last = $tbody.find('tr:last');
                $last.prev().remove();

                rowCount = $('#tblFNMCURRATE tbody tr').length;
            }
        if ($(this).is(':checked'))
            
            var SUBLEDGER_TYPE = $("input:radio[name=SUBLEDGER_TYPE]:checked").val();
        $.get("FNM_SL/GetCatDropDetailListFilter", { SUBLEDGER_TYPE: SUBLEDGER_TYPE }).done(function (response) {
            $('#tblFNMCURRATE tr').each(function (data) {
                $("[name*='FNM_SL1002_CODE']").empty();
                var ary = [];
                ary = response;
                for (var i = 0; i < ary.length; i++) {                    
                    $("[name*='FNM_SL1002_CODE']").append('<option value="' + ary[i].Value + '" selected="">' + ary[i].Text + '</option>');
                }

                $("[name*='FNM_SL1002_CODE']").val(0);
             
            });
        });
        });


       

        var counter = parseInt($("#hdnCounter").val());
        $("#tblFNMCURRATE").on("change", "[name*='FNM_SL1002_CODE']", function () {
            
            var tr = $(this).closest("tr");
            var drec = [];
            $('#tblFNMCURRATE tbody tr td:nth-child(1)').each(function (e) {
                //add item to array
                var tr1 = $(this).closest("tr");
                var ab = tr1.find("[name*='FNM_SL1002_CODE']").val();
                drec.push(ab);
            });
            drec.splice($.inArray(tr.find("[name*='FNM_SL1002_CODE']").val(), drec), 1);

            if ($.inArray(tr.find("[name*='FNM_SL1002_CODE']").val(), drec) >= 0) {
                var dr = tr.find("[name*='FNM_SL1002_CODE']").val();
                tr.css("background", "red");
                tr.find("[name*='FNM_SL1002_CODE']").focus();
                EzAlerterrtxt("Already Exist Code '" + dr + "'");
                tr.find("[name*='FNM_SL1002_CODE']").val('0');

            }
            else {
                tr.css("background", "");

               // var tr = $(this).closest("tr");

                var SUBLEDGER_TYPE = $(this).val();


                $.get("FNM_SL/GetCatDropDetailList", { SUBLEDGER_TYPE: SUBLEDGER_TYPE }).done(function (response) {
                    //var ary = [];
                    //ary = response;
                    counter = 1;
                    tr.find("[name*='FNM_SL1002_CODE']").val(response[0].FNM_SL1002_CODE);
                    tr.find("[name*='NAME']").val(response[0].NAME);
                    tr.find("[name*='COA_CODE']").val(response[0].COA_CODE);
                    tr.find("[name*='COA_NAME']").val(response[0].COA_NAME);
                });

                if (tr.is(":last-child")) {

                    tr.clone(true, true).insertAfter(tr);
                    $("<td><button type='button' class='btn btn-danger' name='btnDelete" + counter + "')'><span class='glyphicon glyphicon-remove'></span></button></td>")
                        .appendTo("#tblFNMCURRATE tbody tr:nth-last-child(2)");
                    var trLast = $("#tableMetaSettings tr:last");
                    var cloned = $("#tblFNMCURRATE tbody tr:last").clone(true); // clone last row
                    // looping over last row's inputs
                    $("#tblFNMCURRATE tbody tr:last").find('select').each(function () {
                        cloned.find('select[name^=' + this.name.replace('[]', '') + ']').val(0);
                    });
                    $("#tblFNMCURRATE > tbody").append(cloned);
                    $("#tblFNMCURRATE > tbody tr:last").prev().remove();

                    trLast.find("[name *= 'FNM_SL1002_CODE']").attr({
                        "name": ("FNM_SL1002_CODE" + counter)
                    });
                    trLast.find("[name *= 'NAME']").attr({
                        "name": ("NAME" + counter)
                    });
                    trLast.find("[name *= 'COA_CODE']").attr({
                        "name": ("COA_CODE" + counter)
                    });
                    trLast.find("[name *= 'COA_NAME']").attr({
                        "name": ("COA_NAME" + counter)
                    });                
                    trLast.find('select[name^=FNM_SL1002_CODE' + counter + ']').val(0);

                    trLast.find(":first").text(counter);

                    trLast.find('.bootstrap-select').replaceWith(function () { return $('select', this); });
                    trLast.find("[name *= 'FNM_SL1002_CODE']").selectpicker('refresh');
                }
                counter++;
            }
        });

        EzGriddel("#tblFNMCURRATE", "[name*='btnDelete']");
        //-------------------


        //$("#SUBLEDGER_TYPE").change(function () {
        //    
        //    $("#tblFNMCURRATE > tbody tr").empty();
        //    $("#tblFNMCURRATE > tbody tr").remove();
        //    var SUBLEDGER_TYPE = $("#SUBLEDGER_TYPE option:selected").val();

        //    $.get("FNM_SL/GetCatDropDetailList", { SUBLEDGER_TYPE: SUBLEDGER_TYPE }).done(function (response) {
        //        var ary = [];
        //        ary = response;
        //        counter = 1;

        //        for (var i = 0; i < ary.length; i++) {
        //            var tr1 = "<tr>";

        //            var td1 = "<td><div class='grid-group'><input type='Text' Readonly='true' class='grid-control' name='FNM_SL1002_CODE" + counter + "'></div></td>";
        //            var td2 = "<td><div class='grid-group'><input type='Text' Readonly='true' class='grid-control' name='NAME" + counter + "'></div></td>";
        //            var td3 = "<td><div class='grid-group'><input type='Text' Readonly='true' class='grid-control' name='Description1" + counter + "'></div></td>";
        //            var td4 = "<td><div class='grid-group'><input type='Text' Readonly='true' class='grid-control' name='COA_CODE" + counter + "'></div></td></tr>";

        //            $("#tblFNMCURRATE").append(tr1 + td1 + td2 + td3+td4);
        //            var tr = $("#tblFNMCURRATE tbody tr");

        //            tr.find("[name='FNM_SL1002_CODE" + counter + "']").val(ary[i].FNM_SL1002_CODE);
        //            tr.find("[name='NAME" + counter + "']").val(ary[i].NAME);
        //            tr.find("[name='COA_CODE" + counter + "']").val(ary[i].COA_CODE);
        //            tr.find("[name='Description1" + counter + "']").val(ary[i].Description1);

                    

        //            counter++;
        //        }
        //    });


       
    });





</script>

<script>
            $(document).ready(function () {
                $(".alert-close").click(function () {
                    $("#editshow").hide();
                });
            });
</script>

<!-- Row start -->
<div class="row">
    <!--updated code-->
    <div class="col-md-12 no-padding navbar-expand-lg">
        <div class="panel-body" style="margin-left:10px;">
            <div class="tabbable-line boxless tabbable-reversed" id="DRContainer">
                <div class="custom-form-wrapper" id="DRContainer">
                    
                    <div class="form-horizontal">
                        <div class="form-body">
                        <div class="col-md-6">
                            <div class="row">
                                <div class="col-md-12">
                                    <div class="form-group">
                                        <label class="control-label col-md-3">Code<i class="star">*</i></label>
                                        <div class="col-md-9 input-field">
                                            @Html.TextBoxFor(m => m.FNM_SL1001_CODE, null, new { @class = "form-control" })
                                        </div>
                                    </div>
                                </div>
                                <!--/span-->
                            </div>
                            <div class="row">
                                <div class="col-md-12">
                                    <div class="form-group">
                                        <label class="control-label col-md-3">Name<i class="star">*</i></label>
                                        <div class="col-md-9 input-field">
                                            @Html.TextBoxFor(m => m.Name, null, new { @class = "form-control" })

                                        </div>
                                    </div>
                                </div>
                            </div>

                            <div class="row">
                                <div class="col-md-12">
                                    <div class="form-group">
                                        <label class="control-label col-md-3">Name Arabic<i class="star">*</i></label>
                                        <div class="col-md-9 input-field">
                                            @Html.TextBoxFor(m => m.Name_Arabic, null, new { @class = "form-control" })

                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="row">
                                <div class="col-md-12">
                                    <div class="form-group">
                                        <label class="control-label col-md-3">Print Name<i class="star">*</i></label>
                                        <div class="col-md-9 input-field">
                                            @Html.TextBoxFor(m => m.Print_Name, null, new { @class = "form-control" })
                                        </div>
                                    </div>
                                </div>
                            </div>
                                        
                            <div class="row">
                                <div class="col-md-12">
                                    <div class="form-group">
                                        <label class="control-label col-md-3">Web site</label>
                                        <div class="col-md-9 input-field">
                                            @Html.TextBoxFor(m => m.Web_site, new { @class = "form-control", @Type = "Text" })
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="row">
                                <div class="col-md-12">
                                    <div class="form-group">
                                        <label class="control-label col-md-3">Email</label>
                                        <div class="col-md-9 input-field">
                                            @Html.TextBoxFor(m => m.Email, new { @class = "form-control", @Type = "Text" })
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="row">
                                <div class="col-md-12">
                                    <div class="form-group">
                                        <label class="control-label col-md-3">Telphone No</label>
                                        <div class="col-md-9 input-field">
                                            @Html.TextBoxFor(m => m.Tel, new { @class = "form-control", @Type = "Text" })
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="row">
                                <div class="col-md-12">
                                    <div class="form-group">
                                        <label class="control-label col-md-3">Fax</label>
                                        <div class="col-md-9 input-field">
                                            @Html.TextBoxFor(m => m.Fax, new { @class = "form-control", @Type = "Text" })
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="row">
                                <div class="col-md-12">
                                    <div class="form-group">
                                        <label class="control-label col-md-3">Address<i class="star">*</i></label>
                                        <div class="col-md-9 input-field">
                                            @Html.TextBoxFor(m => m.Address, new { @class = "form-control", @Type = "Text" })
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="row">
                                <div class="col-md-12">
                                    <div class="form-group">
                                        <label class="control-label col-md-3">Contact1</label>
                                        <div class="col-md-9 input-field">
                                            @Html.TextBoxFor(m => m.Contact1, new { @class = "form-control", @Type = "Text" })
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="row">
                                <div class="col-md-12">
                                    <div class="form-group">
                                        <label class="control-label col-md-3">Contact2</label>
                                        <div class="col-md-9 input-field">
                                            @Html.TextBoxFor(m => m.Contact2, new { @class = "form-control", @Type = "Text" })
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="row">
                                <div class="col-md-12">
                                    <div class="form-group">
                                        <label class="control-label col-md-3">Contact3</label>
                                        <div class="col-md-9 input-field">
                                            @Html.TextBoxFor(m => m.Contact3, new { @class = "form-control", @Type = "Text" })
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>


                        <div class="col-md-6">
                            <div class="row">
                                <div class="col-md-12">
                                    <div class="form-group">
                                        <label class="control-label col-md-3">Currency code<i class="star">*</i></label>
                                        <div class="col-md-9 input-field">
                                            @Html.DropDownListFor(m => m.Currency_code, Model.Currency_codeList, new { @class = "form-control selectpicker", @data_live_search = "true" })
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="row">
                                <div class="col-md-12">
                                    <div class="form-group">
                                        <label class="control-label col-md-3">Credit Limit<i class="star">*</i></label>
                                        <div class="col-md-9 input-field">
                                            @Html.TextBoxFor(m => m.credit_limit, new { @class = "form-control", @Type = "Number" })
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="row" style="display:none">
                                <div class="col-md-12">
                                    <div class="form-group">
                                        <label class="control-label col-md-3">SUBLEDGER TYPE</label>
                                        <div class="col-md-9 input-field">
                                            <label class="radio-inline" checked="checked">
                                                @Html.RadioButtonFor(m => m.SUBLEDGER_TYPE, "FM", new { @checked = "checked" }) Finance Management
                                            </label>
                                            <label class="radio-inline">
                                                @Html.RadioButtonFor(m => m.SUBLEDGER_TYPE, "OP") Freight Management
                                            </label>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <br />

                            <div class="">
                                <ul class="nav nav-tabs">
                                    <li class="active"><a data-toggle="tab" href="#home">Details</a></li>
                                </ul>
                                <div class="tab-content">
                                    <div id="home" class="tab-pane fade in active">
                                        <br /><br />
                                        <div class="row">
                                            <div class="col-md-12">
                                              
                                                    <table class="table table-bordered table-hover" id="tblFNMCURRATE">
                                                        <thead>
                                                            <tr class="tr">
                                                                <th>
                                                                    SubLedger Code
                                                                </th>
                                                                <th>
                                                                    SubLedger Name
                                                                </th>
                                                                <th>
                                                                    COA Code
                                                                </th>
                                                                <th>
                                                                    COA Name
                                                                </th>
                                                                <th></th>
                                                            </tr>
                                                        </thead>
                                                        <tbody>
                                                            <tr>
                                                                <td>
                                                                    <div class="form-group">
                                                                        @Html.DropDownList(string.Concat("FNM_SL1002_CODE", counter), Model.SUBLEDGER_TYPEList, new { @class = "selectpicker grid-control subledg", @data_live_search = "true" })
                                                                    </div>
                                                                </td>
                                                                <td>
                                                                    @Html.TextBox(string.Concat("NAME", counter), null, new { @class = "grid-control" })
                                                                </td>
                                                                
                                                                <td>
                                                                    @Html.TextBox(string.Concat("COA_CODE", counter), null, new { @class = "grid-control" })
                                                                </td>
                                                                <td>
                                                                    @Html.TextBox(string.Concat("COA_NAME", counter), null, new { @class = "grid-control" })
                                                                </td>

                                                            </tr>
                                                        </tbody>
                                                    </table>
                                                  
                                                @Html.Hidden("hdnCounter", (++counter))
                                            </div>

                                        </div>
                                    </div>

                                </div>
                            </div>
                        </div>

                                       


                        </div><br />
                        <!-- END FORM-->
                    </div>
                          
                </div>
            </div>

        </div>

        <!-- Purchase Request List Start-->


       


        <!-- Purchase Request List End -->
        <!-- Row end -->
    </div>


</div>






@model EzBusiness_ViewModels.Models.PurchaseMgmt.PurchaseReqVM
@{
    var counter = 1;
}
<script src="~/Scripts/bootstrap-select.min.js"></script>
<link href="~/Content/bootstrap-select.min.css" rel="stylesheet" />
<script>
    var units = [];
    $(function () {
        //var restyp1 = $("#ResourceType:checked").val();

        //if (restyp1 == "M")
        //{
        //    $.get("PurchaseMgmt/AddPurchaseOrder", function (response) {
        //        $("#POContainer").html(response);
        //    });
        //}

        $('.selectpicker').selectpicker('refresh');
        $("#ProjectCode").change(function () {
            var projectName = $("#ProjectCode option:selected").val();
            $("#MasterWrapper").show();
            if (projectName != "0") {
                $(this).prop("disabled", true);
            }
        });

        //var rest = $("input:radio[name=ResourceType]:checked").val();
        //$.get("PurchaseMgmt/GetItemCodeList", { restyp: rest }).done(function (response) {
        //    $('#tablePODetails tr').each(function (data) {
        //        $("[name*='ItemCode']").empty();
        //        var ary = [];
        //        ary = response;
        //        for (var i = 0; i < ary.length; i++) {

        //            $("[name*='ItemCode']").append('<option value="' + ary[i].Value + '" selected="">' + ary[i].Text + '</option>');

        //        }
        //         $("[name*='ItemCode']").val(0);


        //    });
        //});

        var counter = parseInt($("#hdnCounter").val());
        $("#tablePODetails").on("click", "[name*='btnDelete']", function () {
            $(this).closest("tr").remove();
        });
        $("#tablePODetails").on("change", "[name*='ItemCode']", function () {
            debugger;
            var tr = $(this).closest("tr");

            var rest1 = $("input:radio[name=ResourceType]:checked").val();

            if (rest1 != null)
                {
                $.get("PurchaseReq/GetItemCodeDescription", { itemCode: $(this).val(), restyp: rest1 }).done(function (response) {

                tr.find("[name*='ItemDescription']").val(response.Description);
                tr.find("[name*='ItemUnit']").val(response.Unit);
            });
            }
            if (tr.is(":last-child")) {
                //tr.clone(true, true).insertAfter(tr);
                //$("<td><button type='button' class='btn btn-danger' name='btnDelete" + counter + "')'><span class='glyphicon glyphicon-remove'></span></button></td>")
                //    .appendTo("#tablePODetails tbody tr:nth-last-child(2)");
                //var trLast = $("#tableMetaSettings tr:last")

                tr.clone(true, true).insertAfter(tr);

                $("<td><button type='button' class='btn btn-danger' name='btnDelete" + counter + "')'><span class='glyphicon glyphicon-remove'></span></button></td>")
                    .appendTo("#tablePODetails tbody tr:nth-last-child(2)");
                var trLast = $("#tableMetaSettings tr:last")



                var cloned = $("#tablePODetails tbody tr:last").clone(true); // clone last row
                // looping over last row's inputs
                $("#tablePODetails tbody tr:last").find('select').each(function () {
                    cloned.find('select[name^=' + this.name.replace('[]', '') + ']').val(0);
                });


                $("#tablePODetails > tbody").append(cloned);
                $("#tablePODetails > tbody tr:last").prev().remove();

                trLast.find("[name *= 'ItemCode']").attr({
                    "name": ("ItemCode" + counter)
                });
                trLast.find("[name *= 'ItemDescription']").attr({
                    "name": ("ItemDescription" + counter)
                });
                trLast.find("[name *= 'ItemSpecification']").attr({
                    "name": ("ItemSpecification" + counter)
                });
                trLast.find("[name *= 'ItemUnit']").attr({
                    "name": ("ItemUnit" + counter)
                });
                trLast.find("[name *= 'ItemQuantity']").attr({
                    "name": ("ItemQuantity" + counter)
                });
                trLast.find(":first").text(counter);
            }
            counter++;
        });


        var tablePODetails = $("#tablePODetails tbody tr");

       

        tablePODetails.each(function (index, item) {
            debugger;
            $("[name*='ItemCode" + (index + 1) + "']").val($("[name*='hdnItemCode" + (index + 1) + "']").val());
            $("[name*='ItemDescription" + (index + 1) + "']").val($("[name*='hdnItemDescription" + (index + 1) + "']").val());
            $("[name*='ItemSpecification" + (index + 1) + "']").val($("[name*='hdnItemSpecification" + (index + 1) + "']").val());
            $("[name*='ItemUnit" + (index + 1) + "']").val($("[name*='hdnItemUnit" + (index + 1) + "']").val());
            $("[name*='ItemQuantity" + (index + 1) + "']").val($("[name*='hdnItemQuantity" + (index + 1) + "']").val());
        });
    });
    Date.prototype.getToday = function () {
        var now = new Date();
        var day = ("0" + now.getDate()).slice(-2);
        var month = ("0" + (now.getMonth() + 1)).slice(-2);

        var today = now.getFullYear() + "-" + (month) + "-" + (day);
        return today;
    }
</script>

@*<script src="~/Content/assets/js/dataTables.bootstrap4.min.js"></script>
<script src="~/Content/assets/js/jquery.dataTables.min.js"></script>*@

<div class="row">
    <!--updated code-->
    <div class="col-md-12 no-padding">

        <div class="tabbable-line boxless tabbable-reversed" id="POContainer">
            <div class="custom-form-wrapper">
                <div class="custom-form-wrapper">
                    <!-- BEGIN FORM-->
                    <div class="form-horizontal">
                        <div class="form-body">
                            <div class="row">

                                <div class="col-md-6">
                                    <div class="form-group">
                                        <label class="control-label col-md-4">Project</label>
                                        <div class="col-md-8 input-field">
                                            @Html.DropDownListFor(m => m.ProjectCode, Model.ProjectList, new { @style = "width: 60%", @class = "selectpicker", @data_live_search = "true" })
                                        </div>
                                    </div>
                                </div>

                                <div class="col-md-6">
                                    <div class="form-group">
                                        <label class="control-label col-md-4">MR Code</label>
                                        <div class="col-md-8 input-field">
                                            @Html.TextBoxFor(m => m.MRCode, new { @style = "width: 80%", @class = "form-control", @disabled = "disabled" })
                                        </div>
                                    </div>
                                </div>
                                <div class="col-md-6">
                                    <div class="form-group">
                                        <label class="control-label col-md-3">Date</label>
                                        <div class="col-md-9 input-field">
                                            @Html.EditorFor(m => m.PODate, new { @style = "width: 60%", @class = "form-control" })
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <!--/row-->
                            <div class="row">
                                <div class="col-md-6">
                                    <div class="form-group">
                                        <label class="control-label col-md-4">Resource Type</label>
                                        <div class="col-md-8 input-field">
                                            <label class="radio-inline">
                                                @Html.RadioButtonFor(m => m.ResourceType, "M") Material
                                            </label>
                                            <label class="radio-inline">
                                                @Html.RadioButtonFor(m => m.ResourceType, "A") Asset
                                            </label>
                                            <label class="radio-inline">
                                                @Html.RadioButtonFor(m => m.ResourceType, "S") Service
                                            </label>
                                        </div>
                                    </div>
                                </div>
                                <div class="col-md-6">
                                    <div class="form-group">
                                        <label class="control-label col-md-3">Location</label>
                                        <div class="col-md-9 input-field">
                                            @Html.DropDownListFor(m => m.LocationCode, Model.LocationList, new { @style = "width: 50%", @class = "selectpicker", @data_live_search = "true" })
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <!--/row-->


                            <div class="row">
                                <div class="col-md-6">
                                    <div class="form-group">
                                        <label class="control-label col-md-4">Description </label>
                                        <div class="col-md-8 input-field">
                                            @Html.TextAreaFor(m => m.Description, new { @style = "width: 80%", @class = "form-control", @placeholder = "Level" })
                                        </div>
                                    </div>
                                </div>
                                <div class="col-md-6">
                                    <div class="form-group">
                                        <label class="control-label col-md-3">Requested By </label>
                                        <div class="col-md-9 input-field">
                                            @Html.DropDownListFor(m => m.RequesterCode, Model.RequesterList, new { @style = "width: 50%", @class = "selectpicker", @data_live_search = "true" })
                                        </div>
                                    </div>
                                </div>
                            </div>

                        </div>
                    </div><br />
                    <!-- END FORM-->
                    <div class="portlet-body">
                        <div class="tab-content">
                            <div class="tab-pane active" id="tab_5_1">
                                <div id="sample_1_wrapper" class="dataTables_wrapper no-footer">
                                    <input type="hidden" id="hdnPODetails" name="hdnPODetails" />
                                    <div class="table-scrollable">
                                        <div class="panel panel-primary">
                                            <div class="panel-heading clearfix">
                                                <i class="icon-calendar"></i>
                                                <h3 class="panel-title">Details</h3>
                                            </div>
                                            <table id="tablePODetails" border="1" class="table table-bordered">
                                                <thead>
                                                    <tr>
                                                        <th style="width: 3%">Sr No</th>
                                                        <th style="width: 20%">Item Code</th>
                                                        <th style="width: 30%">Description</th>
                                                        <th style="width: 20%">Specification</th>
                                                        <th style="width: 20%">Unit</th>
                                                        <th style="width: 5%">Quantity</th>

                                                    </tr>
                                                </thead>
                                                <tbody>
                                                    @foreach (var item in Model.PurchaseOrderDetails)
                                                    {
                                                        <tr>
                                                            <td>
                                                                @Html.Label(counter.ToString())
                                                            </td>
                                                            <td>
                                                                <div class="form-group">
                                                                    @Html.DropDownList(string.Concat("ItemCode", counter), Model.ItemCodeList, new { @class = "form-control" })
                                                                    @Html.Hidden(string.Concat("hdnItemCode", counter), item.ItemCode)
                                                                </div>
                                                            </td>
                                                            <td>
                                                                @Html.TextBox(string.Concat("ItemDescription", counter), null, new { @class = "form-control", @disabled = "disabled" })
                                                                @Html.Hidden(string.Concat("hdnItemDescription", counter), item.Description)
                                                            </td>
                                                            <td>
                                                                @Html.TextBox(string.Concat("ItemSpecification", counter), null, new { @class = "form-control" })
                                                                @Html.Hidden(string.Concat("hdnItemSpecification", counter), item.Specification)
                                                            </td>
                                                            <td>
                                                                <div class="form-group">
                                                                    @Html.DropDownList(string.Concat("ItemUnit", counter), Model.UnitList, new { @class = "form-control" })
                                                                    @Html.Hidden(string.Concat("hdnItemUnit", counter), item.Unit)
                                                                </div>
                                                            </td>
                                                            <td>
                                                                <div class="form-group">
                                                                    @Html.TextBox(string.Concat("ItemQuantity", counter), null, new { @class = "form-control" })
                                                                    @Html.Hidden(string.Concat("hdnItemQuantity", counter), item.Quantity)
                                                                </div>
                                                            </td>
                                                        </tr>
                                                        counter++;
                                                    }
                                                    <tr>
                                                        <td>
                                                            @Html.Label(counter.ToString())
                                                        </td>
                                                        <td>
                                                            @Html.DropDownList(string.Concat("ItemCode", counter), Model.ItemCodeList, new { @class = "form-control" })

                                                        </td>
                                                        <td>
                                                            @Html.TextBox(string.Concat("ItemDescription", counter), null, new { @class = "form-control", @disabled = "disabled" })
                                                        </td>
                                                        <td>
                                                            @Html.TextBox(string.Concat("ItemSpecification", counter), null, new { @class = "form-control" })
                                                        </td>
                                                        <td>
                                                            @Html.DropDownList(string.Concat("ItemUnit", counter), Model.UnitList, new { @class = "form-control" })
                                                        </td>
                                                        <td>
                                                            @Html.TextBox(string.Concat("ItemQuantity", counter), null, new { @class = "form-control" })
                                                        </td>
                                                    </tr>
                                                </tbody>
                                            </table>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <!-- <button>Hey, click me!</button> -->
                </div>
            </div>
        </div>
    </div>
</div>
